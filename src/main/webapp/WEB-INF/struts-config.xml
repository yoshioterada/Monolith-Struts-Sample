<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts-config PUBLIC
          "-//Apache Software Foundation//DTD Struts Configuration 1.2//EN"
          "http://struts.apache.org/dtds/struts-config_1_2.dtd">
<struts-config>
  <form-beans>
    <form-bean name="loginForm" type="com.skishop.web.form.LoginForm"/>
    <form-bean name="registerForm" type="com.skishop.web.form.RegisterForm"/>
    <form-bean name="passwordResetRequestForm" type="com.skishop.web.form.PasswordResetRequestForm"/>
    <form-bean name="passwordResetForm" type="com.skishop.web.form.PasswordResetForm"/>
    <form-bean name="productSearchForm" type="com.skishop.web.form.ProductSearchForm"/>
    <form-bean name="addCartForm" type="com.skishop.web.form.AddCartForm"/>
    <form-bean name="checkoutForm" type="com.skishop.web.form.CheckoutForm"/>
    <form-bean name="couponForm" type="com.skishop.web.form.CouponForm"/>
    <form-bean name="addressForm" type="com.skishop.web.form.AddressForm"/>
    <form-bean name="adminProductForm" type="com.skishop.web.form.admin.AdminProductForm"/>
    <form-bean name="adminCouponForm" type="com.skishop.web.form.admin.AdminCouponForm"/>
    <form-bean name="adminShippingMethodForm" type="com.skishop.web.form.admin.AdminShippingMethodForm"/>
  </form-beans>

  <global-exceptions>
    <exception key="error.global" type="java.lang.Exception" path="/error.jsp"/>
  </global-exceptions>

  <global-forwards>
    <forward name="home" path=".home"/>
    <forward name="login" path="/login.do"/>
    <forward name="products" path="/products.do"/>
    <forward name="cart" path="/cart.do"/>
  </global-forwards>

  <!-- Tiles definitions are configured in Phase 4. -->
  <action-mappings>
    <action path="/home"
            type="org.apache.struts.actions.ForwardAction"
            parameter="home"
            validate="false"/>

    <action path="/login"
            type="com.skishop.web.action.LoginAction"
            name="loginForm"
            input="auth.login"
            scope="request"
            validate="true">
      <forward name="success" path="/home.do" redirect="true"/>
      <forward name="failure" path="auth.login"/>
    </action>

    <action path="/register"
            type="com.skishop.web.action.RegisterAction"
            name="registerForm"
            input="auth.register"
            scope="request"
            validate="true">
      <forward name="success" path="/login.do" redirect="true"/>
      <forward name="failure" path="auth.register"/>
    </action>

    <action path="/password/forgot"
            type="com.skishop.web.action.PasswordForgotAction"
            name="passwordResetRequestForm"
            input="auth.password.forgot"
            scope="request"
            validate="true">
      <forward name="success" path="auth.password.forgot_complete"/>
      <forward name="failure" path="auth.password.forgot"/>
    </action>

    <action path="/password/reset"
            type="com.skishop.web.action.PasswordResetAction"
            name="passwordResetForm"
            input="auth.password.reset"
            scope="request"
            validate="true">
      <forward name="success" path="/login.do"/>
      <forward name="failure" path="auth.password.reset"/>
    </action>

    <action path="/products"
            type="com.skishop.web.action.ProductListAction"
            name="productSearchForm"
            input="products.list"
            scope="request"
            validate="false">
      <forward name="success" path="products.list"/>
    </action>

    <action path="/product"
            type="com.skishop.web.action.ProductDetailAction"
            input="products.detail"
            scope="request"
            validate="false">
      <forward name="success" path="products.detail"/>
      <forward name="notfound" path="products.notfound"/>
    </action>

    <action path="/coupons/available"
            type="com.skishop.web.action.CouponAvailableAction"
            input="coupons.available"
            scope="request"
            validate="false">
      <forward name="success" path="coupons.available"/>
    </action>

    <action path="/cart"
            type="com.skishop.web.action.CartAction"
            name="addCartForm"
            input="cart.view"
            scope="session"
            validate="true">
      <forward name="success" path="cart.view"/>
    </action>

    <action path="/checkout"
            type="com.skishop.web.action.CheckoutAction"
            name="checkoutForm"
            input="cart.checkout"
            roles="USER,ADMIN"
            scope="request"
            validate="true">
      <forward name="success" path="cart.confirmation"/>
      <forward name="failure" path="cart.checkout"/>
    </action>

    <action path="/coupon/apply"
            type="com.skishop.web.action.CouponApplyAction"
            name="couponForm"
            input="cart.view"
            roles="USER,ADMIN"
            scope="request"
            validate="true">
      <forward name="success" path="cart.view"/>
      <forward name="failure" path="cart.view"/>
    </action>

    <action path="/orders"
            type="com.skishop.web.action.OrderHistoryAction"
            input="orders.history"
            roles="USER,ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="orders.history"/>
      <forward name="login" path="/login.do"/>
    </action>

    <action path="/orders/detail"
            type="com.skishop.web.action.OrderDetailAction"
            input="orders.detail"
            roles="USER,ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="orders.detail"/>
      <forward name="login" path="/login.do"/>
    </action>

    <action path="/orders/cancel"
            type="com.skishop.web.action.OrderCancelAction"
            roles="USER,ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="/orders.do"/>
      <forward name="failure" path="orders.history"/>
    </action>

    <action path="/orders/return"
            type="com.skishop.web.action.OrderReturnAction"
            roles="USER,ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="/orders.do"/>
      <forward name="failure" path="orders.history"/>
    </action>

    <action path="/points"
            type="com.skishop.web.action.PointBalanceAction"
            input="points.balance"
            roles="USER,ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="points.balance"/>
      <forward name="login" path="/login.do"/>
    </action>

    <action path="/addresses"
            type="com.skishop.web.action.AddressListAction"
            input="account.addresses"
            roles="USER,ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="account.addresses"/>
      <forward name="login" path="/login.do"/>
    </action>

    <action path="/addresses/save"
            type="com.skishop.web.action.AddressSaveAction"
            name="addressForm"
            input="account.address_edit"
            roles="USER,ADMIN"
            scope="request"
            validate="true">
      <forward name="success" path="/addresses.do" redirect="true"/>
      <forward name="failure" path="account.address_edit"/>
      <forward name="login" path="/login.do"/>
    </action>

    <action path="/logout"
            type="com.skishop.web.action.LogoutAction"
            roles="USER,ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="/home.do"/>
    </action>

    <action path="/admin/products"
            type="com.skishop.web.action.admin.AdminProductListAction"
            input="admin.products.list"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="admin.products.list"/>
    </action>

    <action path="/admin/product/edit"
            type="com.skishop.web.action.admin.AdminProductEditAction"
            name="adminProductForm"
            input="admin.products.edit"
            roles="ADMIN"
            scope="request"
            validate="true">
      <forward name="success" path="/admin/products.do"/>
      <forward name="failure" path="admin.products.edit"/>
    </action>

    <action path="/admin/product/delete"
            type="com.skishop.web.action.admin.AdminProductDeleteAction"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="/admin/products.do"/>
      <forward name="failure" path="admin.products.list"/>
    </action>

    <action path="/admin/orders"
            type="com.skishop.web.action.admin.AdminOrderListAction"
            input="admin.orders.list"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="admin.orders.list"/>
    </action>

    <action path="/admin/orders/detail"
            type="com.skishop.web.action.admin.AdminOrderDetailAction"
            input="admin.orders.detail"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="admin.orders.detail"/>
    </action>

    <action path="/admin/order/update"
            type="com.skishop.web.action.admin.AdminOrderUpdateAction"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="/admin/orders.do"/>
      <forward name="failure" path="admin.orders.list"/>
    </action>

    <action path="/admin/order/refund"
            type="com.skishop.web.action.admin.AdminOrderRefundAction"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="/admin/orders.do"/>
      <forward name="failure" path="admin.orders.list"/>
    </action>

    <action path="/admin/coupons"
            type="com.skishop.web.action.admin.AdminCouponListAction"
            input="admin.coupons.list"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="admin.coupons.list"/>
    </action>

    <action path="/admin/coupon/edit"
            type="com.skishop.web.action.admin.AdminCouponEditAction"
            name="adminCouponForm"
            input="admin.coupons.edit"
            roles="ADMIN"
            scope="request"
            validate="true">
      <forward name="success" path="/admin/coupons.do"/>
      <forward name="failure" path="admin.coupons.edit"/>
    </action>

    <action path="/admin/shipping"
            type="com.skishop.web.action.admin.AdminShippingMethodListAction"
            input="admin.shipping.list"
            roles="ADMIN"
            scope="request"
            validate="false">
      <forward name="success" path="admin.shipping.list"/>
    </action>

    <action path="/admin/shipping/edit"
            type="com.skishop.web.action.admin.AdminShippingMethodEditAction"
            name="adminShippingMethodForm"
            input="admin.shipping.edit"
            roles="ADMIN"
            scope="request"
            validate="true">
      <forward name="success" path="/admin/shipping.do"/>
      <forward name="failure" path="admin.shipping.edit"/>
    </action>
  </action-mappings>

  <controller
      processorClass="com.skishop.web.processor.AuthRequestProcessor"
      multipartClass="org.apache.struts.upload.CommonsMultipartRequestHandler"
      maxFileSize="2M"
      memFileSize="64K"
      bufferSize="4096"/>

  <plug-in className="org.apache.struts.tiles.TilesPlugin">
    <set-property property="definitions-config" value="/WEB-INF/tiles-defs.xml"/>
    <set-property property="moduleAware" value="true"/>
    <set-property property="definitions-parser-validate" value="false"/>
  </plug-in>

  <plug-in className="org.apache.struts.validator.ValidatorPlugIn">
    <set-property property="pathnames" value="/WEB-INF/validator-rules.xml,/WEB-INF/validation.xml"/>
  </plug-in>

  <message-resources parameter="messages"/>
</struts-config>
